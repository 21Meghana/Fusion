{% extends 'globals/base.html' %} 
{% load static %} 
{% block title %} 
IPR 
{% endblock %} 
{% block projects %} 
{% block body %}

<script>
  $(".message .close").on("click", function () {
    $(this).closest(".message").transition("fade");
  });

    
    function addCategorySection(event,year,category_subcategory_map) {
      event.preventDefault();
      var category_selection_id = '.'+'category-section-'+year;
      var originalSection = document.querySelector(category_selection_id);
      var clonedSection = originalSection.cloneNode(true); 
      var clonedcatselect_id = '.'+'category-select-'+ year;
      var clonedsubcatselect_id = '.'+'subcategory-select-'+ year;  
      var clonedamount_id = '.'+'amount-'+ year;
      var clonedCategorySelect = clonedSection.querySelector(clonedcatselect_id);   
      var clonedSubcategorySelect = clonedSection.querySelector(clonedsubcatselect_id);
      var clonedAmount = clonedSection.querySelector(clonedamount_id);
      var remove_button_id = '.'+'remove_button-'+year;
      var remove_button = clonedSection.querySelector(remove_button_id);

      remove_button.setAttribute('class','remove_button-'+year);

      clonedSubcategorySelect.disabled = false;
      clonedSubcategorySelect.value = '';
      clonedCategorySelect.value = '';
      category_select_id = '.'+'category-select-'+ year ;
      var fieldcount= document.querySelectorAll(category_select_id).length+1;

      console.log(fieldcount + " field count")
      
      var newName = 'category-select-'+ year+ '-' + fieldcount; // Generate unique ID
      var newSubcategoryName =  'subcategory-select-' + year+ '-' + fieldcount; // Generate unique ID
      var newAmountName = 'amount-'+ year+ '-' + fieldcount; // Generate unique ID
      var newRemoveButton = 'remove_button-'+ year+ '-' + fieldcount; // Generate unique ID

      var newId = newName // Generate unique ID
      var newSubcategoryId = newSubcategoryName; // Generate unique ID
      var newAmountId = newAmountName; // Generate unique ID
      
      clonedCategorySelect.setAttribute('id', newId);
      clonedSubcategorySelect.setAttribute('id', newSubcategoryId);
      clonedAmount.setAttribute('id', newAmountId);
      remove_button.setAttribute('id', newRemoveButton);


      clonedCategorySelect.setAttribute('name', newName);
      clonedSubcategorySelect.setAttribute('name', newSubcategoryName);
      clonedAmount.setAttribute('name', newAmountName);
    
      // Append the cloned section to the container 
      
      var container_id='container-'+year
      console.log(container_id)
      var clonedContainer = document.getElementById(container_id); 
      clonedContainer.setAttribute('id',container_id)
      clonedContainer.appendChild(clonedSection);

      var category_count_id = 'category-count-'+year;
      var category_count = document.getElementById(category_count_id);
      category_count.setAttribute('value',fieldcount);
  }

  function removeCategorySection(event,year,category_subcategory_map) {
    event.preventDefault();
    var category_selection_id = '.'+'category-section-'+year;
    var category_select_id = '.'+'category-select-'+ year ;
    var fieldcount= document.querySelectorAll(category_select_id).length;
    console.log(fieldcount + " field count")
    if (fieldcount > 1) {
      var container_id='container-'+year
      var container = document.getElementById(container_id);
      var currentSection = event.target.parentElement.parentElement;
      container.removeChild(currentSection);
      // to remove corresponding category section
      
      
      var category_count_id = 'category-count-'+year;
      var category_count = document.getElementById(category_count_id);
      category_count.setAttribute('value',fieldcount-1);
    }
  }
  
</script>
<style>
.category {
   display: flex;
  flex-wrap: wrap;
  flex: 1; /* Grow flex items to take up available space */
  margin-right: 10px; /* Add spacing between category sections */
}
.invisible{
  display:none;
}
.f-group {
  margin-bottom: 10px; /* Add margin between form groups */
}

button {
  margin-left: 10px; /* Add space between form and button */
}

</style>
<div class="ui pointing secondary menu" style="font-size: 25px">
  <label
    class="{% if mark5 != 1 and mark6 != 1 and mark7 != 1 %}active item{% else %} item {% endif %}"
  >
    Financial Outlay
  </label>
</div>


<form>
  {% csrf_token %}
  <div class="container" id="container" >
    <div class="category">
        <div class="f-group">
          <label for="staff_id">Staff ID</label>
          <input name="staff_id" id="staff_id" class="staff_id">
        </div>
        <div class="f-group">
          <label for="staff_name">Staff Name</label>
          <input name="staff_name" id="staff_name" class="staff_name">
        </div>
        <div class="f-group">
          <label for="amount">Qualification</label>
          <input name="qualification" id="qualification" class="qualification">
        </div>
        <div class="f-group">
          <label for="year">year</label>
          <input name="year" id="year" class="year">
        </div>
        <div class="f-group">
          <label for="stipened">stipened</label>
          <input name="stipened" id="stipened" class="stipened">
        </div>
      </div> 
    <button class="f-group" onclick="addCategorySection(event,{{year}},{{category_subcategory_map}})">Add Staff</button>

    </div>
  <input type="submit" value="Submit" style="background-color: #007bff; color: #fff; border: none; padding: 10px 20px; cursor: pointer; width: 100%;">
</form>

{% endblock %} 
{% endblock %}